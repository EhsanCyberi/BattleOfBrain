<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¬Ø¨Ù‡Ù‡ Ù…ØºØ²Ù‡Ø§ - Ù†Ø³Ø®Ù‡ Ø¢ÙÙ„Ø§ÛŒÙ†</title>
    <style>
        /* Ø§Ø³ØªØ§ÛŒÙ„ Ù„ÙˆØ¯ÛŒÙ†Ú¯ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #3498db;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 1.2rem;
            margin-top: 15px;
        }
        
        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ Ø¨Ø§Ø²ÛŒ */
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --dark-color: #34495e;
            --light-color: #ecf0f1;
            --text-color: #333;
            --text-light: #fff;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Vazirmatn', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }
        
        body {
            background-color: #f5f5f5;
            color: var(--text-color);
            overflow-x: hidden;
            padding-bottom: 70px;
            background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiPjxkZWZzPjxwYXR0ZXJuIGlkPSJwYXR0ZXJuIiB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHBhdHRlcm5Vbml0cz0idXNlclNwYWNlT25Vc2UiIHBhdHRlcm5UcmFuc2Zvcm09InJvdGF0ZSg0NSkiPjxyZWN0IHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgZmlsbD0icmdiYSgwLDAsMCwwLjAzKSIvPjwvcGF0dGVybj48L2RlZnM+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0idXJsKCNwYXR0ZXJuKSIvPjwvc3ZnPg==');
        }
        
        @font-face {
            font-family: 'Vazirmatn';
            src: url('https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/fonts/webfonts/Vazirmatn-Regular.woff2') format('woff2');
            font-weight: normal;
            font-style: normal;
        }
        
        .container {
            max-width: 100%;
            padding: 10px;
            display: none; /* Ø§Ø¨ØªØ¯Ø§ Ù…Ø®ÙÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯ ØªØ§ Ù„ÙˆØ¯ÛŒÙ†Ú¯ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯ */
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--dark-color));
            color: var(--text-light);
            padding: 15px;
            text-align: center;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border-bottom: 2px solid var(--secondary-color);
        }
        
        .header-title {
            font-size: 1.5rem;
            font-weight: bold;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }
        
        .header-subtitle {
            font-size: 0.8rem;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        .game-area {
            margin-top: 100px;
        }
        
        .map-container {
            position: relative;
            width: 100%;
            height: 500px;
            background-color: #a8d0e6;
            border: 3px solid var(--primary-color);
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiPjxkZWZzPjxwYXR0ZXJuIGlkPSJwYXR0ZXJuIiB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHBhdHRlcm5Vbml0cz0idXNlclNwYWNlT25Vc2UiIHBhdHRlcm5UcmFuc2Zvcm09InJvdGF0ZSg0NSkiPjxyZWN0IHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgZmlsbD0icmdiYSgyNTUsMjU1LDI1NSwwLjA1KSIvPjwvcGF0dGVybj48L2RlZnM+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0idXJsKCNwYXR0ZXJuKSIvPjwvc3ZnPg==');
        }
        
        .country {
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            transition: all 0.3s ease;
            border: 2px solid rgba(255,255,255,0.7);
            z-index: 2;
            overflow: hidden;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            background-size: cover;
            background-position: center;
            background-blend-mode: overlay;
        }
        
        .country::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.1);
            z-index: -1;
        }
        
        .country:hover {
            transform: scale(1.03);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 3;
        }
        
        .country.selected {
            border: 3px solid gold;
            box-shadow: 0 0 15px gold, 0 5px 20px rgba(0,0,0,0.3);
            z-index: 4;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 10px gold; }
            50% { box-shadow: 0 0 20px gold; }
            100% { box-shadow: 0 0 10px gold; }
        }
        
        .country-name {
            background: rgba(0,0,0,0.5);
            padding: 2px 8px;
            border-radius: 10px;
            white-space: nowrap;
        }
        
        .stats-panel {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 1px solid rgba(0,0,0,0.1);
        }
        
        .panel-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--light-color);
        }
        
        .panel-title i {
            font-size: 1.1rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .stat-card {
            background: var(--light-color);
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            transition: all 0.3s;
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 5px;
            color: var(--primary-color);
        }
        
        .stat-label {
            font-size: 0.7rem;
            color: #666;
        }
        
        .stat-icon {
            font-size: 1.5rem;
            margin-bottom: 5px;
            color: var(--secondary-color);
        }
        
        .actions-panel {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 1px solid rgba(0,0,0,0.1);
        }
        
        .btn {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 10px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, var(--secondary-color), #4aa3df);
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .btn i {
            margin-left: 8px;
            font-size: 1.1rem;
        }
        
        .btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            opacity: 0.7;
            transform: none !important;
            box-shadow: none !important;
        }
        
        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn:active:not(:disabled) {
            transform: translateY(0);
        }
        
        .btn-attack {
            background: linear-gradient(135deg, var(--danger-color), #ed7669);
        }
        
        .btn-economy {
            background: linear-gradient(135deg, var(--success-color), #4cdc91);
        }
        
        .btn-military {
            background: linear-gradient(135deg, var(--warning-color), #f8b45a);
        }
        
        .btn-tech {
            background: linear-gradient(135deg, #9b59b6, #b37fc7);
        }
        
        .btn-next {
            background: linear-gradient(135deg, var(--primary-color), var(--dark-color));
        }
        
        .btn-cost {
            background: rgba(0,0,0,0.2);
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
        }
        
        .log-panel {
            background: var(--dark-color);
            color: white;
            border-radius: 15px;
            padding: 15px;
            height: 200px;
            overflow-y: auto;
            font-size: 0.85rem;
            line-height: 1.5;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .log-entry {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .log-time {
            color: #bbb;
            font-size: 0.7rem;
            margin-left: 5px;
        }
        
        .turn-info {
            text-align: center;
            margin-bottom: 15px;
            font-weight: bold;
            color: var(--primary-color);
            background: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .year-display {
            font-size: 1.2rem;
            color: var(--secondary-color);
        }
        
        .tooltip {
            position: fixed;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.8rem;
            pointer-events: none;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.3s;
            max-width: 200px;
            text-align: center;
        }
        
        .country-info {
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px;
            border-radius: 8px;
            font-size: 0.7rem;
            display: none;
            z-index: 5;
        }
        
        .country:hover .country-info {
            display: block;
        }
        
        .country-stats {
            display: flex;
            justify-content: space-between;
        }
        
        .country-stat {
            text-align: center;
            flex: 1;
        }
        
        /* ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ */
        @media (max-width: 400px) {
            .header-title {
                font-size: 1.2rem;
            }
            
            .header-subtitle {
                font-size: 0.7rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stat-value {
                font-size: 1rem;
            }
            
            .btn {
                font-size: 0.8rem;
                padding: 10px 12px;
            }
            
            .log-panel {
                height: 150px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <!-- ØµÙØ­Ù‡ Ù„ÙˆØ¯ÛŒÙ†Ú¯ -->
    <div class="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨Ø§Ø²ÛŒ...</div>
    </div>
    
    <header>
        <div class="header-title">Ø¬Ø¨Ù‡Ù‡ Ù…ØºØ²Ù‡Ø§</div>
        <div class="header-subtitle">front of the brain</div>
    </header>
    
    <div class="container">
        <div class="game-area">
            
            <div class="turn-info">
                <span>Ø³Ø§Ù„: <span id="year" class="year-display">1940</span></span>
                <span> | </span>
                <span>Ù†ÙˆØ¨Øª: <span id="turn">0</span></span>
            </div>
            
            <div class="map-container" id="map">
                <!-- Ú©Ø´ÙˆØ±Ù‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù‚Ø±Ø§Ø± Ù…ÛŒÚ¯ÛŒØ±Ù†Ø¯ -->
            </div>
            
            <div class="stats-panel">
                <div class="panel-title">
                    <span><i class="fas fa-chart-line"></i> Ø¢Ù…Ø§Ø± Ú©Ø´ÙˆØ± Ø´Ù…Ø§</span>
                    <span id="player-country-name" style="font-size: 0.9rem;"></span>
                </div>
                <div class="stats-grid">
                    <div class="stat-card" data-tooltip="Ù…Ù†Ø¨Ø¹ Ø§ØµÙ„ÛŒ Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§Ù… Ø§Ù‚Ø¯Ø§Ù…Ø§Øª. Ù‡Ø± Ø³Ø§Ù„ Ø§Ø² GDP Ùˆ Ø³Ø±Ø²Ù…ÛŒÙ†â€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§ ØªÙˆÙ„ÛŒØ¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯.">
                        <div class="stat-icon"><i class="fas fa-coins"></i></div>
                        <div class="stat-value" id="player-money">100</div>
                        <div class="stat-label">Ù¾ÙˆÙ„ (Ù…ÛŒÙ„ÛŒÙˆÙ†)</div>
                    </div>
                    <div class="stat-card" data-tooltip="Ù…ÛŒØ²Ø§Ù† Ø±Ø´Ø¯ Ø§Ù‚ØªØµØ§Ø¯ÛŒ. Ù‡Ø±Ú†Ù‡ Ø¨ÛŒØ´ØªØ± Ø¨Ø§Ø´Ø¯ Ù¾ÙˆÙ„ Ø¨ÛŒØ´ØªØ±ÛŒ Ø¯Ø± Ù‡Ø± Ù†ÙˆØ¨Øª Ø¯Ø±ÛŒØ§ÙØª Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯.">
                        <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
                        <div class="stat-value" id="player-gdp">5%</div>
                        <div class="stat-label">Ø±Ø´Ø¯ Ø§Ù‚ØªØµØ§Ø¯ÛŒ</div>
                    </div>
                    <div class="stat-card" data-tooltip="Ù‚Ø¯Ø±Øª Ù†Ø¸Ø§Ù…ÛŒ Ø´Ù…Ø§. Ø¨Ø±Ø§ÛŒ Ø­Ù…Ù„Ù‡ Ùˆ Ø¯ÙØ§Ø¹ Ø§Ø² Ú©Ø´ÙˆØ± Ø¶Ø±ÙˆØ±ÛŒ Ø§Ø³Øª.">
                        <div class="stat-icon"><i class="fas fa-shield-alt"></i></div>
                        <div class="stat-value" id="player-army">20</div>
                        <div class="stat-label">Ù†ÛŒØ±ÙˆÛŒ Ù†Ø¸Ø§Ù…ÛŒ</div>
                    </div>
                    <div class="stat-card" data-tooltip="ØªØ¹Ø¯Ø§Ø¯ Ø³Ø±Ø²Ù…ÛŒÙ†â€ŒÙ‡Ø§ÛŒ ØªØ­Øª Ú©Ù†ØªØ±Ù„ Ø´Ù…Ø§. Ù‡Ø±Ú†Ù‡ Ø¨ÛŒØ´ØªØ± Ø¨Ø§Ø´Ø¯ Ø¯Ø±Ø¢Ù…Ø¯ Ø¨ÛŒØ´ØªØ±ÛŒ Ø¯Ø§Ø±ÛŒØ¯.">
                        <div class="stat-icon"><i class="fas fa-map-marked-alt"></i></div>
                        <div class="stat-value" id="player-land">1</div>
                        <div class="stat-label">Ø³Ø±Ø²Ù…ÛŒÙ†</div>
                    </div>
                    <div class="stat-card" data-tooltip="Ø¬Ù…Ø¹ÛŒØª Ú©Ø´ÙˆØ± Ø´Ù…Ø§. Ù‡Ø±Ú†Ù‡ Ø¨ÛŒØ´ØªØ± Ø¨Ø§Ø´Ø¯ Ø±Ø´Ø¯ Ø§Ù‚ØªØµØ§Ø¯ÛŒ Ø¨Ù‡ØªØ±ÛŒ Ø¯Ø§Ø±ÛŒØ¯.">
                        <div class="stat-icon"><i class="fas fa-users"></i></div>
                        <div class="stat-value" id="player-population">10</div>
                        <div class="stat-label">Ø¬Ù…Ø¹ÛŒØª (Ù…ÛŒÙ„ÛŒÙˆÙ†)</div>
                    </div>
                    <div class="stat-card" data-tooltip="Ø³Ø·Ø­ ÙÙ†Ø§ÙˆØ±ÛŒ Ø´Ù…Ø§. Ø¨Ø± Ù‚Ø¯Ø±Øª Ù†Ø¸Ø§Ù…ÛŒØŒ Ø±Ø´Ø¯ Ø§Ù‚ØªØµØ§Ø¯ÛŒ Ùˆ Ø¯Ø±Ø¢Ù…Ø¯ ØªØ£Ø«ÛŒØ± Ù…ÛŒâ€ŒÚ¯Ø°Ø§Ø±Ø¯.">
                        <div class="stat-icon"><i class="fas fa-microchip"></i></div>
                        <div class="stat-value" id="player-tech">1</div>
                        <div class="stat-label">Ø³Ø·Ø­ ÙÙ†Ø§ÙˆØ±ÛŒ</div>
                    </div>
                </div>
            </div>
            
            <div class="actions-panel">
                <div class="panel-title"><i class="fas fa-chess-king"></i> Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒÚ©</div>
                <div class="btn">
                    <span><i class="fas fa-tasks"></i> Ø¹Ù…Ù„ÛŒØ§Øª Ù…Ø¬Ø§Ø²</span>
                    <div class="btn-cost">
                        <span id="action-number"></span><span>/3 <i class="fas fa-bolt"></i></span>
                    </div>
                </div>
                <button id="economy-btn" class="btn btn-economy">
                    <span><i class="fas fa-building"></i> ØªÙ‚ÙˆÛŒØª Ø§Ù‚ØªØµØ§Ø¯</span>
                    <div>
                        <span class="btn-cost">40 <i class="fas fa-coins"></i></span>
                    </div>
                </button>
                <button id="military-btn" class="btn btn-military">
                    <span><i class="fas fa-fighter-jet"></i> ØªÙ‚ÙˆÛŒØª Ù†Ø¸Ø§Ù…ÛŒ</span>
                    <div>
                        <span class="btn-cost">40 <i class="fas fa-coins"></i></span>
                    </div>
                </button>
                <button id="tech-btn" class="btn btn-tech">
                    <span><i class="fas fa-laptop-code"></i> Ø§Ø±ØªÙ‚Ø§ÛŒ ÙÙ†Ø§ÙˆØ±ÛŒ</span>
                    <div>
                        <span class="btn-cost">80 <i class="fas fa-coins"></i></span>
                    </div>
                </button>
                <button id="attack-btn" class="btn btn-attack" disabled>
                    <span><i class="fas fa-crosshairs"></i> Ø­Ù…Ù„Ù‡</span>
                    <span class="btn-cost">40 <i class="fas fa-shield-alt"></i></span>
                </button>
                <button id="next-turn-btn" class="btn btn-next">
                    <span><i class="fas fa-forward"></i> Ø¯ÙˆØ± Ø¨Ø¹Ø¯</span>
                    <span><i class="fas fa-calendar-alt"></i></span>
                </button>
            </div>
            
            <div class="log-panel" id="log"></div>
        </div>
    </div>
    
    <div class="tooltip" id="tooltip"></div>

<script>
        // Game initialization and core logic - completely rewritten for balance and fun
        (function() {
            // Wait for all resources to load, then hide loading overlay and start game
            window.addEventListener('load', function() {
                setTimeout(function() {
                    document.querySelector('.loading-overlay').style.display = 'none';
                    document.querySelector('.container').style.display = 'block';
                    initGame();
                }, 1000); // keep the 1s splash for smoothness
            });

            // ==================== GAME CONFIGURATION ====================
            const gameConfig = {
                difficulty: 'hard',           // only hard mode â€“ but AI is balanced
                playerCountry: null,           // id of player's country
                selectedCountry: null,         // currently selected target country id
                year: 1940,
                turn: 0,
                gameStarted: false,
                gameOver: false,
                maxActionsPerTurn: 3,
                actionsThisTurn: 0,
                conqueredRequired: 0.75        // need 75% of world to win
            };

            // Colors and names (20 countries â€“ untouched)
            const countryColors = [
                '#e74c3c', '#3498db', '#2ecc71', '#f1c40f', '#9b59b6',
                '#1abc9c', '#e67e22', '#34495e', '#d35400', '#27ae60',
                '#8e44ad', '#16a085', '#333', '#2980b9', '#f39c12',
                '#7f8c8d', '#ff0000', '#0600c8', '#d7d7d7', '#00ffb1'
            ];
            const countryNames = [
                'Ø¢Ø±Ù…Ø§Ù†ÛŒØ§', 'Ø¨Ù„Ø§Ø±ÛŒØ§', 'ØªÙˆØ±Ø§Ù†ÛŒØ§', 'Ø¯Ù„Ù…Ø§Ú©Ø§', 'Ø³Ø§Ø±ÙˆÛŒØ§',
                'ÙØ§Ø±Ù„Ù†Ø¯', 'Ú¯ÙˆØ±Ø³ØªØ§Ù†', 'Ù‡ÙˆØ±ØªØ§Ù†', 'ÛŒÙˆÙ„Ø§Ù†Ø¯Ø§', 'Ø²Ù†Ø¯Ø§Ø±ÛŒØ§',
                'Ú©Ø§Ù„ÛŒØ¯ÙˆÙ†', 'Ù…ÙˆØ±ÛŒØªØ§Ù†ÛŒ', 'Ù†ÙˆØ±Ø³Ú©', 'Ø§ÙˆÙ„Ù…Ù¾ÛŒØ§', 'Ù¾Ø§Ø±Ø³Ø§',
                'Ú©ÙˆÛŒØ³ØªØ§', 'Ø±ÛŒÚ¯ÙˆÙ„ÙˆØ³', 'Ø³Ø§Ù…Ø§Ø±Ø§', 'ØªØ±Ø§Ú©ÛŒØ§', 'ÙˆÛŒÚ©ØªÙˆØ±ÛŒØ§'
            ];
            const countryPositions = [
                { left: (2-1), top: 5, width: 20, height: 15 },   // 0
                { left: (30-1), top: 5, width: 20, height: 15 },  // 1
                { left: (55-1), top: 5, width: 20, height: 15 },  // 2
                { left: (80-1), top: 5, width: 20, height: 15 },  // 3
                { left: (2-1), top: 25, width: 20, height: 15 },  // 4
                { left: (30-1), top: 25, width: 20, height: 15 }, // 5
                { left: (55-1), top: 25, width: 20, height: 15 }, // 6
                { left: (80-1), top: 25, width: 20, height: 15 }, // 7
                { left: (2-1), top: 45, width: 20, height: 15 },  // 8
                { left: (30-1), top: 45, width: 20, height: 15 }, // 9
                { left: (55-1), top: 45, width: 20, height: 15 }, // 10
                { left: (80-1), top: 45, width: 20, height: 15 }, // 11
                { left: (2-1), top: 65, width: 20, height: 15 },   // 12
                { left: (30-1), top: 65, width: 20, height: 15 },  // 13
                { left: (55-1), top: 65, width: 20, height: 15 },  // 14
                { left: (80-1), top: 65, width: 20, height: 15 },  // 15
                { left: (2-1), top: 83, width: 20, height: 15 },   // 16
                { left: (30-1), top: 83, width: 20, height: 15 },  // 17
                { left: (55-1), top: 83, width: 20, height: 15 },  // 18
                { left: (80-1), top: 83, width: 20, height: 15 }   // 19
            ];

            // ==================== COUNTRIES DATA ====================
            let countries = [];

            function initializeCountries() {
                countries = Array(20).fill().map((_, i) => ({
                    id: i,
                    name: countryNames[i],
                    originalName: countryNames[i],
                    color: countryColors[i],
                    money: Math.floor(100 + Math.random() * 80),      // 100â€“180
                    gdp: 3 + Math.random() * 5,                       // 3%â€“8%
                    army: 20 + Math.floor(Math.random() * 30),        // 20â€“50
                    land: 1,                                           // each starts with 1 territory
                    population: 8 + Math.random() * 10,               // 8â€“18 million
                    tech: 1,
                    isConquered: false,
                    conqueredBy: null,
                    turnsSinceLastAttack: 0,                           // for AI cooldown
                    position: countryPositions[i]
                }));
                // Initialize relations (not used heavily but kept for structure)
                countries.forEach(c => {
                    c.relations = {};
                    countries.forEach(other => {
                        if (other.id !== c.id) c.relations[other.id] = Math.floor(Math.random() * 20 - 10);
                    });
                });
            }

            // ==================== DOM ELEMENTS ====================
            const mapElement = document.getElementById('map');
            const yearElement = document.getElementById('year');
            const turnElement = document.getElementById('turn');
            const playerCountryNameElement = document.getElementById('player-country-name');
            const playerMoneyElement = document.getElementById('player-money');
            const playerGdpElement = document.getElementById('player-gdp');
            const playerArmyElement = document.getElementById('player-army');
            const playerLandElement = document.getElementById('player-land');
            const playerPopulationElement = document.getElementById('player-population');
            const playerTechElement = document.getElementById('player-tech');
            const economyBtn = document.getElementById('economy-btn');
            const militaryBtn = document.getElementById('military-btn');
            const techBtn = document.getElementById('tech-btn');
            const attackBtn = document.getElementById('attack-btn');
            const nextTurnBtn = document.getElementById('next-turn-btn');
            const logElement = document.getElementById('log');
            const tooltipElement = document.getElementById('tooltip');
            const actionNumber = document.getElementById('action-number');


            actionNumber.innerHTML = Math.abs(gameConfig.actionsThisTurn - 3)
            function showActionsNumber() {
                actionNumber.innerHTML = Math.abs(gameConfig.actionsThisTurn - 3)
            }

            
            // ==================== HELPER FUNCTIONS ====================
            function addLogMessage(message, sender = 'Ø³ÛŒØ³ØªÙ…') {
                const now = new Date();
                const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';
                const senderSpan = document.createElement('span');
                // Color coding
                const colors = {
                    'Ø³ÛŒØ³ØªÙ…': '#3498db', 'Ø§Ø·Ù„Ø§Ø¹Ø§Øª': '#2ecc71', 'Ù‡Ø´Ø¯Ø§Ø±': '#e74c3c',
                    'Ù¾ÛŒØ±ÙˆØ²ÛŒ': '#f1c40f', 'Ø´Ú©Ø³Øª': '#e74c3c', 'Ø§Ù‚ØªØµØ§Ø¯': '#2ecc71',
                    'Ù†Ø¸Ø§Ù…ÛŒ': '#f39c12', 'ÙÙ†Ø§ÙˆØ±ÛŒ': '#9b59b6', 'Ø±ÙˆÛŒØ¯Ø§Ø¯': '#1abc9c',
                    'Ù¾ÛŒØ±ÙˆØ²ÛŒ Ù†Ù‡Ø§ÛŒÛŒ': '#f1c40f', 'Ø´Ú©Ø³Øª Ù†Ù‡Ø§ÛŒÛŒ': '#c0392b'
                };
                senderSpan.style.color = colors[sender] || '#f39c12';
                senderSpan.textContent = `[${sender}] `;
                const messageSpan = document.createElement('span');
                messageSpan.textContent = message;
                const timeSpan = document.createElement('span');
                timeSpan.className = 'log-time';
                timeSpan.textContent = timeString;
                logEntry.appendChild(senderSpan);
                logEntry.appendChild(messageSpan);
                logEntry.appendChild(timeSpan);
                logElement.appendChild(logEntry);
                logElement.scrollTop = logElement.scrollHeight;
            }

            function updatePlayerStats() {
                if (gameConfig.playerCountry === null || gameConfig.gameOver) {
                    // disable all action buttons
                    [economyBtn, militaryBtn, techBtn, attackBtn].forEach(btn => btn.disabled = true);
                    return;
                }
                const p = countries[gameConfig.playerCountry];
                playerCountryNameElement.textContent = p.name;
                playerMoneyElement.textContent = Math.floor(p.money);
                playerGdpElement.textContent = p.gdp.toFixed(1) + '%';
                playerArmyElement.textContent = Math.floor(p.army);
                playerLandElement.textContent = p.land;
                playerPopulationElement.textContent = p.population.toFixed(1);
                playerTechElement.textContent = p.tech;

                // Enable/disable based on resources, actions left, and game state
                const actionsLeft = gameConfig.maxActionsPerTurn - gameConfig.actionsThisTurn;
                economyBtn.disabled = gameConfig.gameOver || actionsLeft <= 0 || p.money < 40;
                militaryBtn.disabled = gameConfig.gameOver || actionsLeft <= 0 || p.money < 40;
                techBtn.disabled = gameConfig.gameOver || actionsLeft <= 0 || p.money < 80;
                // Attack requires: target selected, enough army (>=30), enough money (40), and action left
                const targetOk = gameConfig.selectedCountry !== null; // Ø´Ø±Ø· isConquered Ø±Ùˆ Ø¨Ø±Ø¯Ø§Ø´ØªÙ…
                attackBtn.disabled = gameConfig.gameOver || actionsLeft <= 0 || p.money < 40 || p.army < 30 || !targetOk;
            }

            function renderMap() {
                mapElement.innerHTML = '';
                countries.forEach(c => {
                    if (c.land <= 0) return;
                    const el = document.createElement('div');
                    el.className = 'country';
                    el.id = `country-${c.id}`;
                    
                    // Color: if conquered, use conqueror's color
                    if (c.isConquered && c.conqueredBy !== null) {
                        const conqueror = countries[c.conqueredBy];
                        el.style.backgroundColor = conqueror ? conqueror.color : '#888';
                    } else {
                        el.style.backgroundColor = c.color;
                    }
                    
                    el.style.width = c.position.width + '%';
                    el.style.height = c.position.height + '%';
                    el.style.left = c.position.left + '%';
                    el.style.top = c.position.top + '%';

                    const nameDiv = document.createElement('div');
                    nameDiv.className = 'country-name';
                    nameDiv.textContent = c.isConquered ? c.originalName + ' (Ù…Ø³ØªØ¹Ù…Ø±Ù‡)' : c.name;
                    el.appendChild(nameDiv);

                    // Hover info - FIXED: Show correct country's stats
                    const infoDiv = document.createElement('div');
                    infoDiv.className = 'country-info';
                    const statsDiv = document.createElement('div');
                    statsDiv.className = 'country-stats';
                    
                    // ØªØ¹ÛŒÛŒÙ† Ú©Ø´ÙˆØ± Ø§ØµÙ„ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¢Ù…Ø§Ø±
                    let displayCountry = c;
                    if (c.isConquered && c.conqueredBy !== null) {
                        displayCountry = countries[c.conqueredBy]; // Ø¢Ù…Ø§Ø± Ú©Ø´ÙˆØ± ØµØ§Ø­Ø¨â€ŒÙ…Ø³ØªØ¹Ù…Ø±Ù‡ Ø±Ùˆ Ù†Ø´ÙˆÙ† Ø¨Ø¯Ù‡
                    }
                    
                    statsDiv.innerHTML = `
                        <div class="country-stat"><i class="fas fa-shield-alt"></i> ${Math.floor(displayCountry.army)}</div>
                        <div class="country-stat"><i class="fas fa-coins"></i> ${Math.floor(displayCountry.money)}</div>
                        <div class="country-stat"><i class="fas fa-map-marked-alt"></i> ${displayCountry.land}</div>
                    `;
                    infoDiv.appendChild(statsDiv);
                    el.appendChild(infoDiv);

                    el.addEventListener('click', (e) => {
                        e.stopPropagation();
                        selectCountry(c.id);
                    });
                    mapElement.appendChild(el);
                });

                // Highlight player country if any
                if (gameConfig.playerCountry !== null) {
                    const playerEl = document.getElementById(`country-${gameConfig.playerCountry}`);
                    if (playerEl) playerEl.style.boxShadow = '0 0 15px rgba(255,255,255,0.8)';
                }
                // Highlight selected target
                if (gameConfig.selectedCountry !== null) {
                    const targetEl = document.getElementById(`country-${gameConfig.selectedCountry}`);
                    if (targetEl) targetEl.classList.add('selected');
                }
            }

            // ==================== PLAYER ACTIONS ====================
            function improveEconomy() {
                if (!canPerformAction()) return;
                const p = countries[gameConfig.playerCountry];
                if (p.money < 40) { addLogMessage('Ù¾ÙˆÙ„ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª! (Ù†ÛŒØ§Ø² 40)', 'Ù‡Ø´Ø¯Ø§Ø±'); return; }
                p.money -= 40;
                const gain = 0.8 + (p.tech * 0.3);
                p.gdp += gain;
                gameConfig.actionsThisTurn++;
                addLogMessage(`Ø§Ù‚ØªØµØ§Ø¯ ØªÙ‚ÙˆÛŒØª Ø´Ø¯: +${gain.toFixed(1)}% Ø±Ø´Ø¯ Ø§Ù‚ØªØµØ§Ø¯ÛŒ.`, 'Ø§Ù‚ØªØµØ§Ø¯');
                // small chance of population boost
                if (Math.random() < 0.3) {
                    const popGain = p.population * 0.02 * (1 + p.tech * 0.05);
                    p.population += popGain;
                    addLogMessage(`Ø±Ø´Ø¯ Ø§Ù‚ØªØµØ§Ø¯ÛŒ Ø¨Ø§Ø¹Ø« Ø§ÙØ²Ø§ÛŒØ´ Ø¬Ù…Ø¹ÛŒØª (+${popGain.toFixed(1)} Ù…ÛŒÙ„ÛŒÙˆÙ†) Ø´Ø¯.`, 'Ø§Ù‚ØªØµØ§Ø¯');
                }
                showActionsNumber();
                updatePlayerStats();
                renderMap(); // maybe color change? no, but to keep consistency
            }

            function improveMilitary() {
                if (!canPerformAction()) return;
                const p = countries[gameConfig.playerCountry];
                if (p.money < 40) { addLogMessage('Ù¾ÙˆÙ„ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª! (Ù†ÛŒØ§Ø² 40)', 'Ù‡Ø´Ø¯Ø§Ø±'); return; }
                p.money -= 40;
                const gain = 12 + (p.tech * 3) + Math.floor(Math.random() * 8);
                p.army += gain;
                gameConfig.actionsThisTurn++;
                addLogMessage(`Ù†ÛŒØ±ÙˆÛŒ Ù†Ø¸Ø§Ù…ÛŒ +${gain} ÙˆØ§Ø­Ø¯ ØªÙ‚ÙˆÛŒØª Ø´Ø¯.`, 'Ù†Ø¸Ø§Ù…ÛŒ');
                showActionsNumber();
                updatePlayerStats();
                renderMap();
            }

            function improveTechnology() {
                if (!canPerformAction()) return;
                const p = countries[gameConfig.playerCountry];
                if (p.money < 80) { addLogMessage('Ù¾ÙˆÙ„ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª! (Ù†ÛŒØ§Ø² 80)', 'Ù‡Ø´Ø¯Ø§Ø±'); return; }
                p.money -= 80;
                p.tech += 1;
                gameConfig.actionsThisTurn++;
                showActionsNumber();
                addLogMessage(`ÙÙ†Ø§ÙˆØ±ÛŒ Ø¨Ù‡ Ø³Ø·Ø­ ${p.tech} Ø§Ø±ØªÙ‚Ø§ ÛŒØ§ÙØª.`, 'ÙÙ†Ø§ÙˆØ±ÛŒ');
                // side benefits
                if (Math.random() < 0.5) {
                    const bonus = 5 + p.tech * 2;
                    p.army += bonus;
                    addLogMessage(`ÙÙ†Ø§ÙˆØ±ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ù‡ Ù†ÛŒØ±ÙˆÛŒ Ù†Ø¸Ø§Ù…ÛŒ +${bonus} Ú©Ù…Ú© Ú©Ø±Ø¯.`, 'ÙÙ†Ø§ÙˆØ±ÛŒ');
                }
                if (Math.random() < 0.3) {
                    const bonus = 0.5 + p.tech * 0.2;
                    p.gdp += bonus;
                    addLogMessage(`ÙÙ†Ø§ÙˆØ±ÛŒ Ø¨Ø§Ø¹Ø« Ø±Ø´Ø¯ Ø§Ù‚ØªØµØ§Ø¯ÛŒ +${bonus.toFixed(1)}% Ø´Ø¯.`, 'ÙÙ†Ø§ÙˆØ±ÛŒ');
                }
                updatePlayerStats();
                renderMap();
            }


            function attackCountry() {
                if (!canPerformAction()) return;
                const attacker = countries[gameConfig.playerCountry];
                const targetId = gameConfig.selectedCountry;
                if (targetId === null || targetId === gameConfig.playerCountry) {
                    addLogMessage('Ù‡Ø¯Ù Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª.', 'Ù‡Ø´Ø¯Ø§Ø±'); return;
                }
                
                const defender = countries[targetId];
                
                // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ú©Ø´ÙˆØ± Ø§ØµÙ„ÛŒ (Ø§Ú¯Ù‡ Ù…Ø³ØªØ¹Ù…Ø±Ù‡ Ø¨Ø§Ø´Ù‡)
                let targetCountry = defender;
                let originalOwner = null;
                if (defender.isConquered) {
                    originalOwner = countries[defender.conqueredBy];
                    targetCountry = originalOwner; // Ú©Ø´ÙˆØ± Ø§ØµÙ„ÛŒ Ø±Ùˆ Ù‡Ø¯Ù Ù‚Ø±Ø§Ø± Ø¨Ø¯Ù‡
                }
                
                if (attacker.money < 40) { addLogMessage('Ù¾ÙˆÙ„ Ú©Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø­Ù…Ù„Ù‡ Ù†Ø¯Ø§Ø±ÛŒØ¯ (40).', 'Ù‡Ø´Ø¯Ø§Ø±'); return; }
                if (attacker.army < 30) { addLogMessage('Ù†ÛŒØ±ÙˆÛŒ Ù†Ø¸Ø§Ù…ÛŒ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª (Ø­Ø¯Ø§Ù‚Ù„ 30).', 'Ù‡Ø´Ø¯Ø§Ø±'); return; }

                // Ú©Ù… Ú©Ø±Ø¯Ù† Ù‡Ø²ÛŒÙ†Ù‡
                attacker.money -= 40;
                gameConfig.actionsThisTurn++;
                showActionsNumber();

                // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚Ø¯Ø±Øª
                const attackerPower = attacker.army * (1 + attacker.tech * 0.2);
                const defenderPower = targetCountry.army * (1 + targetCountry.tech * 0.1) * 1.3;
                const randomFactor = 0.9 + Math.random() * 0.2;

                if (attackerPower * randomFactor > defenderPower) {
                    // Ù¾ÛŒØ±ÙˆØ²ÛŒ - Ú©Ù„ Ú©Ø´ÙˆØ± ÙØªØ­ Ù…ÛŒØ´Ù‡
                    const landGain = targetCountry.land;
                    const popGain = targetCountry.population * 0.8;
                    const moneyGain = targetCountry.money * (0.6 + attacker.tech * 0.02);
                    const armyLoss = attacker.army * (0.2 - attacker.tech * 0.01);
                    
                    attacker.land += landGain;
                    attacker.population += popGain;
                    attacker.money += moneyGain;
                    attacker.army = Math.max(1, attacker.army - armyLoss);

                    // Ù‡Ù…Ù‡ Ù…Ø³ØªØ¹Ù…Ø±Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÙˆÙ† Ú©Ø´ÙˆØ± Ø±Ùˆ Ù‡Ù… Ø¨Ù‡ Ù…Ø§Ù„Ú©ÛŒØª ØªÙˆ Ø¯Ø±Ø¨ÛŒØ§Ø±
                    countries.forEach(c => {
                        if (c.conqueredBy === targetCountry.id) {
                            c.conqueredBy = attacker.id;
                        }
                    });

                    // Ø®ÙˆØ¯ Ú©Ø´ÙˆØ± Ø§ØµÙ„ÛŒ Ø±Ùˆ ÙØªØ­ Ú©Ù†
                    targetCountry.isConquered = true;
                    targetCountry.conqueredBy = attacker.id;

                    addLogMessage(`âœ¨ Ù¾ÛŒØ±ÙˆØ²ÛŒ! Ú©Ù„ Ø§Ù…Ù¾Ø±Ø§ØªÙˆØ±ÛŒ ${targetCountry.name} ÙØªØ­ Ø´Ø¯! +${landGain} Ø³Ø±Ø²Ù…ÛŒÙ†ØŒ +${Math.floor(popGain)} Ù…ÛŒÙ„ÛŒÙˆÙ† Ø¬Ù…Ø¹ÛŒØªØŒ +${Math.floor(moneyGain)} Ù¾ÙˆÙ„.`, 'Ù¾ÛŒØ±ÙˆØ²ÛŒ');
                    
                    // Ú†Ú© Ú©Ø±Ø¯Ù† Ø´Ø±Ø· Ø¨Ø±Ø¯
                    const totalCountries = countries.length;
                    const conqueredByPlayer = countries.filter(c => c.isConquered && c.conqueredBy === gameConfig.playerCountry).length;
                    const playerOwned = 1 + conqueredByPlayer;
                    if (playerOwned / totalCountries >= gameConfig.conqueredRequired) {
                        addLogMessage('ğŸ‰ Ø´Ù…Ø§ Û·ÛµÙª Ø¬Ù‡Ø§Ù† Ø±Ø§ ÙØªØ­ Ú©Ø±Ø¯ÛŒØ¯! Ù¾ÛŒØ±ÙˆØ²ÛŒ Ø¨Ø²Ø±Ú¯!', 'Ù¾ÛŒØ±ÙˆØ²ÛŒ Ù†Ù‡Ø§ÛŒÛŒ');
                        gameConfig.gameOver = true;
                        celebrateVictory();
                    }
                } else {
                    // Ø´Ú©Ø³Øª
                    const armyLoss = attacker.army * (0.3 - attacker.tech * 0.01);
                    attacker.army = Math.max(1, attacker.army - armyLoss);
                    
                    let defenderName = targetCountry.name;
                    if (defender.isConquered && originalOwner) {
                        defenderName = `${targetCountry.name} (Ø­Ù…Ù„Ù‡ Ø§Ø² Ø·Ø±ÛŒÙ‚ Ù…Ø³ØªØ¹Ù…Ø±Ù‡ ${defender.originalName})`;
                    }
                    
                    addLogMessage(`ğŸ’” Ø­Ù…Ù„Ù‡ Ø¨Ù‡ ${defenderName} Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯! ${Math.floor(armyLoss)} ÙˆØ§Ø­Ø¯ Ù†Ø¸Ø§Ù…ÛŒ Ø§Ø² Ø¯Ø³Øª Ø±ÙØª.`, 'Ø´Ú©Ø³Øª');

                    // Ø¶Ø¯Ø­Ù…Ù„Ù‡
                    if (Math.random() < 0.6) {
                        const counterDamage = targetCountry.army * (0.15 + Math.random() * 0.1);
                        attacker.army = Math.max(1, attacker.army - counterDamage);
                        addLogMessage(`âš ï¸ Ø¶Ø¯Ø­Ù…Ù„Ù‡ ${targetCountry.name}: ${Math.floor(counterDamage)} ÙˆØ§Ø­Ø¯ Ø¯ÛŒÚ¯Ø± Ù†Ø§Ø¨ÙˆØ¯ Ø´Ø¯.`, 'Ù‡Ø´Ø¯Ø§Ø±');
                    }
                }

                // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ø¯Ù Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
                document.getElementById(`country-${targetId}`)?.classList.remove('selected');
                gameConfig.selectedCountry = null;
                updatePlayerStats();
                renderMap();
            }


            function canPerformAction() {
                if (gameConfig.gameOver) return false;
                if (gameConfig.playerCountry === null) {
                    addLogMessage('Ø§Ø¨ØªØ¯Ø§ Ú©Ø´ÙˆØ± Ø®ÙˆØ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.', 'Ù‡Ø´Ø¯Ø§Ø±');
                    return false;
                }
                if (gameConfig.actionsThisTurn >= gameConfig.maxActionsPerTurn) {
                    addLogMessage('Ø´Ù…Ø§ Ø¯Ø± Ø§ÛŒÙ† Ø¯ÙˆØ± Ø§Ù‚Ø¯Ø§Ù…ÛŒ Ø¨Ø§Ù‚ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯. Ø¯Ú©Ù…Ù‡ "Ø¯ÙˆØ± Ø¨Ø¹Ø¯" Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯.', 'Ù‡Ø´Ø¯Ø§Ø±');
                    return false;
                }
                return true;
            }

            // ==================== TURN PROCESSING ====================
            function nextTurn() {
                if (gameConfig.gameOver) return;
                if (gameConfig.playerCountry === null) {
                    addLogMessage('Ø§Ø¨ØªØ¯Ø§ Ú©Ø´ÙˆØ± Ø®ÙˆØ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.', 'Ù‡Ø´Ø¯Ø§Ø±');
                    return;
                }

                // Reset actions for new turn
                gameConfig.actionsThisTurn = 0;
                gameConfig.turn++;
                gameConfig.year++;
                yearElement.textContent = gameConfig.year;
                turnElement.textContent = gameConfig.turn;

                // Player income
                const p = countries[gameConfig.playerCountry];
                const income = p.gdp * p.land * (0.8 + p.tech * 0.2); // gdp% * land * multiplier
                p.money += Math.floor(income);
                // Population growth
                const popGrowth = p.population * (0.01 + p.gdp * 0.0005) * (1 + p.tech * 0.02);
                p.population += popGrowth;

                addLogMessage(`Ø¯ÙˆØ± Ø¬Ø¯ÛŒØ¯: Ø¯Ø±Ø¢Ù…Ø¯ ${Math.floor(income)} Ù¾ÙˆÙ„ | Ø±Ø´Ø¯ Ø¬Ù…Ø¹ÛŒØª ${popGrowth.toFixed(2)} Ù…ÛŒÙ„ÛŒÙˆÙ†`, 'Ø§Ù‚ØªØµØ§Ø¯');

                // Check if player lost (land zero) - shouldn't happen normally
                if (p.land <= 0) {
                    addLogMessage('Ø´Ù…Ø§ ØªÙ…Ø§Ù… Ø³Ø±Ø²Ù…ÛŒÙ†â€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø§Ø² Ø¯Ø³Øª Ø¯Ø§Ø¯ÛŒØ¯. Game Over', 'Ø´Ú©Ø³Øª Ù†Ù‡Ø§ÛŒÛŒ');
                    gameConfig.gameOver = true;
                    updatePlayerStats();
                    renderMap();
                    return;
                }

                // AI updates
                updateAICountries();

                // Random events
                processRandomEvents();

                // Re-render map (in case AI conquered something)
                renderMap();
                updatePlayerStats();
                showActionsNumber();
            }

            function updateAICountries() {
                const playerId = gameConfig.playerCountry;
                // First, increment turnsSinceLastAttack for all AI
                countries.forEach(c => { if (!c.isConquered && c.id !== playerId) c.turnsSinceLastAttack++; });

                for (let i = 0; i < countries.length; i++) {
                    const ai = countries[i];
                    if (ai.isConquered || ai.id === playerId) continue;

                    // AI income
                    const income = ai.gdp * ai.land * 0.7; // slightly less efficient than player
                    ai.money += Math.floor(income);
                    ai.population += ai.population * 0.008;

                    // AI decision making - based on turn and resources
                    const turn = gameConfig.turn;
                    // Aggressiveness grows slowly, max 0.4 by turn 20
                    let baseAggro = Math.min(0.15 + turn * 0.012, 0.4);
                    // Adjust based on relative strength (optional)
                    
                    // Each AI may spend money on improvements or save for attack
                    if (ai.money > 60 && Math.random() < 0.4) {
                        // Improve military (preferred) or tech
                        if (Math.random() < 0.7 || ai.tech < 2) {
                            // military
                            const cost = 40;
                            if (ai.money >= cost) {
                                ai.money -= cost;
                                ai.army += 15 + ai.tech * 2;
                            }
                        } else {
                            // tech upgrade
                            const cost = 80;
                            if (ai.money >= cost) {
                                ai.money -= cost;
                                ai.tech += 1;
                            }
                        }
                    }

                    // Attack decision
                    // Conditions: enough army, money, cooldown passed, and random chance
                    if (ai.army > 35 && ai.money > 80 && ai.turnsSinceLastAttack > 3 && Math.random() < baseAggro) {
                        // Find potential targets: non-conquered, not itself, not allied (we ignore relations)
                        const targets = countries.filter(c => !c.isConquered && c.id !== ai.id);
                        if (targets.length === 0) continue;
                        // Prefer weak targets (low army) or sometimes target player
                        targets.sort((a, b) => a.army - b.army);
                        // 30% chance to attack player if player is weak enough
                        let target = null;
                        if (playerId !== null && !countries[playerId].isConquered && Math.random() < 0.3) {
                            target = countries[playerId];
                        } else {
                            target = targets[0]; // weakest
                        }
                        if (!target) continue;

                        // Attack calculation
                        const aiPower = ai.army * (1 + ai.tech * 0.15);
                        const defPower = target.army * (1 + target.tech * 0.1);
                        if (aiPower > defPower * 1.1) { // confident
                            // AI wins
                            ai.land += target.land;
                            ai.population += target.population * 0.7;
                            ai.money += target.money * 0.5;
                            ai.army = Math.max(1, ai.army * 0.7); // lose some
                            target.isConquered = true;
                            target.conqueredBy = ai.id;
                            ai.turnsSinceLastAttack = 0;
                            addLogMessage(`âš ï¸ ${ai.name} Ø¨Ù‡ ${target.originalName} Ø­Ù…Ù„Ù‡ Ú©Ø±Ø¯ Ùˆ Ø¢Ù† Ø±Ø§ ÙØªØ­ Ú©Ø±Ø¯.`, 'Ø§Ø·Ù„Ø§Ø¹Ø§Øª');
                            if (target.id === playerId) {
                                addLogMessage('ğŸ’€ Ú©Ø´ÙˆØ± Ø´Ù…Ø§ ØªÙˆØ³Ø· Ø¯Ø´Ù…Ù† ÙØªØ­ Ø´Ø¯!', 'Ø´Ú©Ø³Øª Ù†Ù‡Ø§ÛŒÛŒ');
                                gameConfig.gameOver = true;
                                return;
                            }
                        } else {
                            // AI loses
                            ai.army = Math.max(1, ai.army * 0.6);
                            ai.turnsSinceLastAttack = 0;
                            addLogMessage(`${ai.name} Ø¨Ù‡ ${target.originalName} Ø­Ù…Ù„Ù‡ Ú©Ø±Ø¯ Ùˆ Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯.`, 'Ø§Ø·Ù„Ø§Ø¹Ø§Øª');
                        }
                    }
                }
            }

            function processRandomEvents() {
                // Events only for independent countries (including player)
                const active = countries.filter(c => !c.isConquered);
                active.forEach(c => {
                    const r = Math.random();
                    if (r < 0.1) { // 10% chance of event
                        const type = Math.floor(Math.random() * 5);
                        switch(type) {
                            case 0: // economic boom
                                c.money += 20 + Math.random() * 30;
                                addLogMessage(`Ø±ÙˆÙ†Ù‚ Ø§Ù‚ØªØµØ§Ø¯ÛŒ Ø¯Ø± ${c.name}: +${Math.floor(20+Math.random()*30)} Ù¾ÙˆÙ„`, 'Ø±ÙˆÛŒØ¯Ø§Ø¯');
                                break;
                            case 1: // recession
                                c.money = Math.max(0, c.money - (15 + Math.random() * 25));
                                addLogMessage(`Ø±Ú©ÙˆØ¯ Ø¯Ø± ${c.name}: Ú©Ø§Ù‡Ø´ Ù¾ÙˆÙ„`, 'Ø±ÙˆÛŒØ¯Ø§Ø¯');
                                break;
                            case 2: // military discovery
                                c.army += 10 + Math.random() * 20;
                                addLogMessage(`Ú©Ø´Ù Ù†Ø¸Ø§Ù…ÛŒ Ø¯Ø± ${c.name}: Ù†ÛŒØ±ÙˆÛŒ Ù†Ø¸Ø§Ù…ÛŒ Ø§ÙØ²Ø§ÛŒØ´ ÛŒØ§ÙØª`, 'Ø±ÙˆÛŒØ¯Ø§Ø¯');
                                break;
                            case 3: // tech breakthrough
                                if (Math.random() < 0.5) {
                                    c.tech += 1;
                                    addLogMessage(`Ù¾ÛŒØ´Ø±ÙØª ÙÙ†Ø§ÙˆØ±ÛŒ Ø¯Ø± ${c.name}`, 'Ø±ÙˆÛŒØ¯Ø§Ø¯');
                                }
                                break;
                            case 4: // unrest
                                c.army = Math.max(1, c.army * 0.9);
                                addLogMessage(`Ù†Ø§Ø¢Ø±Ø§Ù…ÛŒ Ø¯Ø± ${c.name}: Ú©Ø§Ù‡Ø´ Ù†ÛŒØ±ÙˆÛŒ Ù†Ø¸Ø§Ù…ÛŒ`, 'Ø±ÙˆÛŒØ¯Ø§Ø¯');
                                break;
                        }
                    }
                });
            }

            // ==================== UI & SELECTION ====================
            function selectCountry(id) {
                if (gameConfig.gameOver) return;
                
                if (!gameConfig.gameStarted) {
                    // First selection: choose player country
                    gameConfig.playerCountry = id;
                    gameConfig.gameStarted = true;
                    addLogMessage(`Ø´Ù…Ø§ Ú©Ø´ÙˆØ± ${countries[id].name} Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø±Ø¯ÛŒØ¯.`, 'Ø³ÛŒØ³ØªÙ…');
                    addLogMessage('Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù‡Ø± Ù†ÙˆØ¨Øª Û³ Ø§Ù‚Ø¯Ø§Ù… Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯. Ø¨Ø§ Ø­Ù…Ù„Ù‡ Ùˆ ØªÙ‚ÙˆÛŒØªØŒ Ø§Ù…Ù¾Ø±Ø§ØªÙˆØ±ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø³Ø§Ø²ÛŒØ¯.', 'Ø³ÛŒØ³ØªÙ…');
                    renderMap();
                    updatePlayerStats();
                    return;
                }

                // In-game: select target for attack
                if (id === gameConfig.playerCountry) {
                    // clicking own country: deselect target if any
                    if (gameConfig.selectedCountry !== null) {
                        document.getElementById(`country-${gameConfig.selectedCountry}`)?.classList.remove('selected');
                        gameConfig.selectedCountry = null;
                        attackBtn.disabled = true;
                    }
                    return;
                }
                
                const target = countries[id];
                
                // Deselect previous
                if (gameConfig.selectedCountry !== null) {
                    document.getElementById(`country-${gameConfig.selectedCountry}`)?.classList.remove('selected');
                }
                
                // Select new
                document.getElementById(`country-${id}`)?.classList.add('selected');
                gameConfig.selectedCountry = id;
                
                // Show appropriate info based on whether it's a colony or original country
                if (target.isConquered) {
                    const owner = countries[target.conqueredBy];
                    addLogMessage(`ğŸ¯ Ù‡Ø¯Ù: Ù…Ø³ØªØ¹Ù…Ø±Ù‡ ${target.originalName} (ØªØ­Øª Ù…Ø§Ù„Ú©ÛŒØª ${owner.name}) - Ù†ÛŒØ±Ùˆ: ${Math.floor(target.army)} - Ù¾ÙˆÙ„: ${Math.floor(target.money)}`, 'Ø§Ø·Ù„Ø§Ø¹Ø§Øª');
                } else {
                    addLogMessage(`ğŸ¯ Ù‡Ø¯Ù: ${target.name} - Ù†ÛŒØ±Ùˆ: ${Math.floor(target.army)} - Ù¾ÙˆÙ„: ${Math.floor(target.money)}`, 'Ø§Ø·Ù„Ø§Ø¹Ø§Øª');
                }
                
                updatePlayerStats(); // enables attack button if conditions met
            }

            // ==================== VICTORY CELEBRATION ====================
            function celebrateVictory() {
                const messages = [
                    "Ø´Ù…Ø§ ÛŒÚ© Ø§Ù…Ù¾Ø±Ø§ØªÙˆØ±ÛŒ Ø¨ÛŒâ€ŒÙ†Ø¸ÛŒØ± Ø³Ø§Ø®ØªÛŒØ¯!",
                    "ØªÙ…Ø§Ù… Ø¬Ù‡Ø§Ù† ØªØ­Øª Ú©Ù†ØªØ±Ù„ Ø´Ù…Ø§Ø³Øª!",
                    "Ù¾Ø§Ø¯Ø´Ø§Ù‡ÛŒ Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ù‚Ø±Ù†â€ŒÙ‡Ø§ Ø§Ø¯Ø§Ù…Ù‡ Ø®ÙˆØ§Ù‡Ø¯ ÛŒØ§ÙØª!",
                    "Ù‡ÛŒÚ† Ú©Ø³ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¯Ø± Ø¨Ø±Ø§Ø¨Ø± Ù‚Ø¯Ø±Øª Ø´Ù…Ø§ Ù…Ù‚Ø§ÙˆÙ…Øª Ú©Ù†Ø¯!",
                    "ØªØ¨Ø±ÛŒÚ©! Ø´Ù…Ø§ Ø¨Ø²Ø±Ú¯â€ŒØªØ±ÛŒÙ† ÙØ±Ù…Ø§Ù†Ø±ÙˆØ§ÛŒ ØªØ§Ø±ÛŒØ® Ø´Ø¯ÛŒØ¯!"
                ];
                messages.forEach((msg, idx) => {
                    setTimeout(() => addLogMessage(msg, 'Ù¾ÛŒØ±ÙˆØ²ÛŒ Ù†Ù‡Ø§ÛŒÛŒ'), idx * 2000);
                });

                // Simple confetti
                const confettiContainer = document.createElement('div');
                confettiContainer.style.position = 'fixed';
                confettiContainer.style.top = '0';
                confettiContainer.style.left = '0';
                confettiContainer.style.width = '100%';
                confettiContainer.style.height = '100%';
                confettiContainer.style.pointerEvents = 'none';
                confettiContainer.style.zIndex = '1000';
                document.body.appendChild(confettiContainer);
                for (let i = 0; i < 100; i++) {
                    const conf = document.createElement('div');
                    conf.style.position = 'absolute';
                    conf.style.width = '8px';
                    conf.style.height = '8px';
                    conf.style.backgroundColor = `hsl(${Math.random()*360}, 100%, 60%)`;
                    conf.style.borderRadius = '50%';
                    conf.style.left = Math.random() * 100 + '%';
                    conf.style.top = '-10px';
                    conf.style.animation = `fall ${3+Math.random()*4}s linear forwards`;
                    confettiContainer.appendChild(conf);
                }
                const style = document.createElement('style');
                style.textContent = `@keyframes fall { to { transform: translateY(100vh) rotate(720deg); opacity: 0; } }`;
                document.head.appendChild(style);
            }

            // ==================== TOOLTIPS ====================
            function setupTooltips() {
                document.querySelectorAll('.stat-card[data-tooltip]').forEach(card => {
                    const text = card.dataset.tooltip;
                    card.addEventListener('mouseenter', (e) => {
                        tooltipElement.textContent = text;
                        tooltipElement.style.left = (e.clientX + 15) + 'px';
                        tooltipElement.style.top = (e.clientY + 15) + 'px';
                        tooltipElement.style.opacity = '1';
                    });
                    card.addEventListener('mouseleave', () => tooltipElement.style.opacity = '0');
                    card.addEventListener('mousemove', (e) => {
                        tooltipElement.style.left = (e.clientX + 15) + 'px';
                        tooltipElement.style.top = (e.clientY + 15) + 'px';
                    });
                });
            }

            // ==================== INIT ====================
            function initGame() {
                initializeCountries();
                renderMap();
                setupEventListeners();
                setupTooltips();
                addLogMessage('Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ Ø¨Ù‡ Ø¨Ø§Ø²ÛŒ Ø¬Ø¨Ù‡Ù‡ Ù…ØºØ²Ù‡Ø§', 'Ø³ÛŒØ³ØªÙ…');
                addLogMessage('Ø¨Ø§Ø²ÛŒ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª! Ø±ÙˆÛŒ ÛŒÚ© Ú©Ø´ÙˆØ± Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ØªØ§ Ø¢Ù† Ø±Ø§ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ú©Ø´ÙˆØ± Ø®ÙˆØ¯ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.', 'Ø³ÛŒØ³ØªÙ…');
                // Reset UI
                gameConfig.playerCountry = null;
                gameConfig.selectedCountry = null;
                gameConfig.gameStarted = false;
                gameConfig.gameOver = false;
                gameConfig.turn = 0;
                gameConfig.year = 1940;
                gameConfig.actionsThisTurn = 0;
                yearElement.textContent = gameConfig.year;
                turnElement.textContent = gameConfig.turn;
                updatePlayerStats();
            }

            function setupEventListeners() {
                economyBtn.addEventListener('click', improveEconomy);
                militaryBtn.addEventListener('click', improveMilitary);
                techBtn.addEventListener('click', improveTechnology);
                attackBtn.addEventListener('click', attackCountry);
                nextTurnBtn.addEventListener('click', nextTurn);
                window.addEventListener('resize', () => renderMap());
            }
        })();
</script>
</body>
</html>